document.addEventListener("DOMContentLoaded",()=>{Object.keys(localStorage).forEach((key)=>{if(key.startsWith("integraMente")||key.startsWith("juegosCompletados_")){localStorage.removeItem(key)}});const sectionNombre=document.getElementById("section-nombre");const sectionEdad=document.getElementById("section-edad");const sectionInicio=document.getElementById("section-inicio");const inputNombre=document.getElementById("input-nombre");const inputEdad=document.getElementById("input-edad");const btnNextNombre=document.getElementById("btn-next-nombre");const btnBackEdad=document.getElementById("btn-back-edad");const btnNextEdad=document.getElementById("btn-next-edad");const saludoUsuarioText=document.getElementById("saludo-usuario");const btnSalir=document.getElementById("btn-salir");const btnIniciarPensar=document.getElementById("iniciar-pensar");const juegoContainer=document.getElementById("juego-pensar");const seccionJuegoCard=document.querySelector("#seccion-pensar .seccion-juego-card");const tiempoPensar=document.getElementById("tiempo-pensar");const nivelPensar=document.getElementById("nivel-pensar");const btnResetPensar=document.getElementById("reset-pensar");const btnNextPensar=document.getElementById("next-pensar");const pensarGrid=document.getElementById("pensar-grid");const btnIniciarSocial=document.getElementById("iniciar-social");const juegoSocialContainer=document.getElementById("juego-social");const seccionSocialCard=document.querySelector("#seccion-social .seccion-juego-card");let juegoSocialActivo=!1;const btnIniciarCrear=document.getElementById("iniciar-crear");const juegoCrearContainer=document.getElementById("juego-crear");const seccionCrearCard=document.querySelector("#seccion-crear .seccion-juego-card");let juegoCrearActivo=!1;let nivelActual=1;let tiempoRestante=20;let intervalId=null;let juegoTerminado=!1;let aciertos=0;let juegoActivo=!1;let juegosCompletados=[];const niveles={1:{imagen:"1-trébol",imagenCorrecta:"1-trébol-correcto"},2:{imagen:"2-árbol",imagenCorrecta:"2-árbol-correcto"},3:{imagen:"3-mariquita",imagenCorrecta:"3-mariquita-correcto"},4:{imagen:"4-plants",imagenCorrecta:"4-plants-correcto"},5:{imagen:"5-girasol",imagenCorrecta:"5-girasol-correcto"},};if(btnIniciarPensar){btnIniciarPensar.addEventListener("click",()=>{if(!juegosCompletados.includes("pensar")){seccionJuegoCard.style.display="none";juegoContainer.style.display="block";juegoActivo=!0;iniciarNivel(1)}})}
if(btnIniciarSocial){btnIniciarSocial.addEventListener("click",()=>{seccionSocialCard.style.display="none";juegoSocialContainer.style.display="block";juegoSocialActivo=!0;if(window.jugarSocial&&window.jugarSocial.iniciarNivel){window.jugarSocial.iniciarNivel(1)}})}
if(btnIniciarCrear){btnIniciarCrear.addEventListener("click",()=>{if(window.juegosCompletados&&window.juegosCompletados.includes("crear")){return}
seccionCrearCard.style.display="none";juegoCrearContainer.style.display="block";juegoCrearActivo=!0;if(window.jugarCrear&&window.jugarCrear.iniciarNivel){window.jugarCrear.iniciarNivel(1)}})}
if(btnResetPensar){btnResetPensar.addEventListener("click",()=>{const hayResultadosVisibles=juegoContainer.querySelector(".resultado-juego");if(hayResultadosVisibles){return}
detenerTemporizador();nivelActual=1;aciertos=0;iniciarNivel(1)})}
if(btnNextPensar){btnNextPensar.addEventListener("click",()=>{if(nivelActual<5){nivelActual++;iniciarNivel(nivelActual)}else{mostrarResultadoFinal()}})}
function iniciarNivel(nivel){nivelPensar.textContent=nivel;btnNextPensar.disabled=!0;juegoTerminado=!1;pensarGrid.innerHTML="";generarImagenes(nivel);tiempoRestante=20;tiempoPensar.textContent=tiempoRestante;iniciarTemporizador()}
function generarImagenes(nivel){const{imagen,imagenCorrecta}=niveles[nivel];const posicionCorrecta=Math.floor(Math.random()*20);for(let i=0;i<20;i++){const imgElement=document.createElement("img");imgElement.classList.add("imagen-opcion");if(i===posicionCorrecta){imgElement.src=`img/icons/${imagenCorrecta}.webp`;imgElement.dataset.correcta="true"}else{imgElement.src=`img/icons/${imagen}.webp`;imgElement.dataset.correcta="false"}
imgElement.addEventListener("click",manejarSeleccion);pensarGrid.appendChild(imgElement)}}
function manejarSeleccion(event){if(juegoTerminado)return;const elemento=event.target;const esCorrecta=elemento.dataset.correcta==="true";detenerTemporizador();juegoTerminado=!0;if(esCorrecta){elemento.classList.add("imagen-correcta");aciertos++}else{elemento.classList.add("imagen-incorrecta");const imagenCorrecta=document.querySelector('[data-correcta="true"]');imagenCorrecta.classList.add("imagen-correcta")}
btnNextPensar.disabled=!1}
function iniciarTemporizador(){detenerTemporizador();intervalId=setInterval(()=>{tiempoRestante--;tiempoPensar.textContent=tiempoRestante;if(tiempoRestante<=0){detenerTemporizador();tiempoAgotado()}},1000)}
function detenerTemporizador(){if(intervalId){clearInterval(intervalId);intervalId=null}}
function tiempoAgotado(){juegoTerminado=!0;const imagenCorrecta=document.querySelector('[data-correcta="true"]');imagenCorrecta.classList.add("imagen-correcta");btnNextPensar.disabled=!1}
function mostrarResultadoFinal(){pensarGrid.innerHTML="";const nombreUsuario=localStorage.getItem("integraMenteNombreUsuario")||"";if(!juegosCompletados.includes("pensar")){juegosCompletados.push("pensar")}
window.juegosCompletados=juegosCompletados;const resultadoElement=juegoContainer.querySelector(".resultado-juego");if(btnResetPensar){btnResetPensar.disabled=!0}
if(btnNextPensar){btnNextPensar.disabled=!0}
const puntaje=aciertos;window.puntajesJuegos.pensar=aciertos;const puntajeElement=document.getElementById("puntaje-pensar");if(puntajeElement){puntajeElement.textContent=`${puntaje}/5`}
resultadoElement.style.display="block";const btnVolver=resultadoElement.querySelector(".btn-volver");btnVolver.addEventListener("click",()=>{limpiarJuego();juegoContainer.style.display="none";juegoActivo=!1;const btnPensar=document.getElementById("iniciar-pensar");if(btnPensar){btnPensar.textContent="FINALIZADO";btnPensar.disabled=!0;btnPensar.classList.add("juego-finalizado")}
seccionJuegoCard.style.display="flex"})}
function limpiarJuego(){detenerTemporizador();pensarGrid.innerHTML="";const resultadoElement=juegoContainer.querySelector(".resultado-juego");if(resultadoElement){resultadoElement.style.display="none"}
nivelActual=1;aciertos=0;juegoTerminado=!1}
const logoContainer=document.querySelector("header .logo-container");const mainElement=document.querySelector("main");function actualizarVisibilidadComunes(mostrarEnInicio){const footer=document.getElementById("main-footer");if(logoContainer){logoContainer.style.display=mostrarEnInicio?"none":"flex"}
if(mainElement){if(mostrarEnInicio){mainElement.classList.add("inicio-activo");if(footer)footer.style.display="flex"}else{mainElement.classList.remove("inicio-activo");if(footer)footer.style.display="none"}}}
if(btnSalir){btnSalir.addEventListener("click",()=>{sectionInicio.style.display="none";sectionNombre.style.display="flex";inputNombre.focus();actualizarVisibilidadComunes(!1);const footer=document.getElementById("main-footer");if(footer)footer.style.display="none";if(saludoUsuarioText){saludoUsuarioText.textContent="Hola, "}})}
inputNombre.addEventListener("input",()=>{const nombreValido=validarNombre(inputNombre.value);btnNextNombre.disabled=!nombreValido});btnNextNombre.addEventListener("click",()=>{if(!btnNextNombre.disabled){sectionNombre.style.display="none";sectionEdad.style.display="flex";inputEdad.focus();actualizarVisibilidadComunes(!1)}});inputEdad.addEventListener("input",()=>{const edadValida=validarEdad(inputEdad.value);btnNextEdad.disabled=!edadValida});btnBackEdad&&btnBackEdad.addEventListener("click",()=>{sectionEdad.style.display="none";sectionNombre.style.display="flex";inputNombre.focus();actualizarVisibilidadComunes(!1)});btnNextEdad.addEventListener("click",()=>{if(!btnNextEdad.disabled){sectionEdad.style.display="none";sectionInicio.style.display="flex";actualizarVisibilidadComunes(!0);const nombreUsuario=inputNombre.value.trim();const edadUsuario=inputEdad.value;localStorage.setItem("integraMenteNombreUsuario",nombreUsuario);localStorage.setItem("integraMenteEdadUsuario",edadUsuario);localStorage.setItem("integraMenteSesionActiva","true");if(nombreUsuario){saludoUsuarioText.textContent=`Hola, ${nombreUsuario}!`}
mostrarSoloSeccionInicio("inicio")}});if(btnSalir){btnSalir.addEventListener("click",()=>{window.location.reload()})}
function validarNombre(nombre){const regex=/^[a-zA-ZáéíóúÁÉÍÓÚñÑ\s]{1,20}$/;return regex.test(nombre.trim())&&nombre.trim().length>0}
function validarEdad(edad){const edadNum=parseInt(edad,10);return(!isNaN(edadNum)&&edadNum>=6&&edadNum<=12&&edad.length>0&&edad.length<=2)}
const mainContent=document.getElementById("inicio-main-content");const navItems=document.querySelectorAll(".nav-item");const seccionesIds={inicio:"seccion-inicio-main",pensar:"seccion-pensar",social:"seccion-social",crear:"seccion-crear",logros:"seccion-logros",};function mostrarSoloSeccionInicio(key){Object.values(seccionesIds).forEach((id)=>{const div=document.getElementById(id);if(div)div.style.display="none"});const mostrar=document.getElementById(seccionesIds[key]);if(mostrar)mostrar.style.display=""}
navItems.forEach((item)=>{item.addEventListener("click",(e)=>{e.preventDefault();const texto=item.querySelector(".nav-text").textContent.trim().toLowerCase();let key="inicio";if(texto==="pensar")key="pensar";else if(texto==="social")key="social";else if(texto==="crear")key="crear";else if(texto==="logros")key="logros";const logrosResultados=document.getElementById("logros-resultados");if(logrosResultados&&logrosResultados.style.display==="block"){if(key!=="logros"&&window.ocultarResultadosLogros){window.ocultarResultadosLogros()}}
if(juegoActivo){if(juegoContainer.style.display!=="none"&&key!=="pensar"){limpiarJuego();juegoContainer.style.display="none";juegoActivo=!1;seccionJuegoCard.style.display="flex";if(juegosCompletados.includes("pensar")){const btnPensar=document.getElementById("iniciar-pensar");if(btnPensar){btnPensar.textContent="FINALIZADO";btnPensar.disabled=!0;btnPensar.classList.add("juego-finalizado")}}}else if(juegoContainer.style.display!=="none"&&key==="pensar"){if(!juegoContainer.querySelector(".resultado-juego")){limpiarJuego();iniciarNivel(1);return}}}
if(juegoSocialActivo){if(juegoSocialContainer.style.display!=="none"&&key!=="social"){const resultadoElement=juegoSocialContainer.querySelector(".social-resultado");const hayResultadosVisibles=resultadoElement&&resultadoElement.style.display==="block";if(hayResultadosVisibles&&!juegosCompletados.includes("social")){juegosCompletados.push("social")}
if(window.jugarSocial&&window.jugarSocial.limpiarJuego){window.jugarSocial.limpiarJuego()}
juegoSocialContainer.style.display="none";juegoSocialActivo=!1;seccionSocialCard.style.display="flex";if(juegosCompletados.includes("social")){const btnSocial=document.getElementById("iniciar-social");if(btnSocial){btnSocial.textContent="FINALIZADO";btnSocial.disabled=!0;btnSocial.classList.add("juego-finalizado")}}}}
if(juegoCrearActivo){if(juegoCrearContainer.style.display!=="none"&&key!=="crear"){const resultadoElement=juegoCrearContainer.querySelector(".crear-resultado");const hayResultadosVisibles=resultadoElement&&resultadoElement.style.display==="block";if(hayResultadosVisibles&&!juegosCompletados.includes("crear")){juegosCompletados.push("crear")}
if(window.jugarCrear&&window.jugarCrear.limpiarJuego){window.jugarCrear.limpiarJuego()}
juegoCrearContainer.style.display="none";juegoCrearActivo=!1;seccionCrearCard.style.display="flex";if(juegosCompletados.includes("crear")){const btnCrear=document.getElementById("iniciar-crear");if(btnCrear){btnCrear.textContent="FINALIZADO";btnCrear.disabled=!0;btnCrear.classList.add("juego-finalizado")}}}}
mostrarSoloSeccionInicio(key)})});sectionNombre.style.display="flex";sectionEdad.style.display="none";sectionInicio.style.display="none";window.juegosCompletados=juegosCompletados;window.puntajesJuegos={pensar:0,social:{empatia:0,pensamiento:0,resolucion:0,},crear:{originalidad:0,imaginacion:0,percepcionEstetica:0,},}})